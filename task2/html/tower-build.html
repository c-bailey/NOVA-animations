<html>
<body>
<script src="raphael-min.js"></script>
<div id="foo" style="background-color:#000"></div>
<script>

    var r = Raphael('foo', 1009, 633),

        originX = 0,
        originY = 126,

        mainUnit = 126,

        midFloorHeight = mainUnit*2/3,
        indentUnit = mainUnit/3,
        

        jumpHeight = -(midFloorHeight+10),

        heightXOne = originX + jumpHeight,
        heightXTwo = originX + 2*jumpHeight,
        heightXThree = originX + 3*jumpHeight - mainUnit/3,
        heightYOne = originY + jumpHeight,
        heightYTwo = originY + 2*jumpHeight,
        heightYThree = originY + 3*jumpHeight - mainUnit/3,

        indentHeight = mainUnit-indentUnit,
        indentStartPt = heightXThree+indentUnit,
        indentEndPt = indentStartPt+indentHeight,

        starUnit = indentHeight/5,
        starHeight = 4*starUnit,
        starStartPt = indentEndPt+2.5*starUnit,
        starEndPt = indentStartPt+2.5*starUnit,
        starLimb = 1.5*starUnit,

        duration = 2000,
        squareL = 'l' + mainUnit + '  ' + mainUnit + ' l' + mainUnit + '  0   l-' + mainUnit + ' -' + mainUnit + ' l-' + mainUnit + ' 0',
        squareR = 'l' + mainUnit + '  ' + mainUnit + ' l0   ' + mainUnit + '  l-' + mainUnit + ' -' + mainUnit + ' l0  -' + mainUnit + '',
        
        rectangleL = 'l' + midFloorHeight + '  ' + midFloorHeight + ' l' + mainUnit + '  0   l-' + midFloorHeight + ' -' + midFloorHeight + ' l-' + mainUnit + ' 0',
        rectangleR = 'l' + midFloorHeight + '  ' + midFloorHeight + ' l0   ' + mainUnit + '  l-' + midFloorHeight + ' -' + midFloorHeight + ' l0  -' + mainUnit + '',

        baseL = r.path('M' + originX + ' ' + originY + ' ' + squareL),
        baseR = r.path('M' + originY + ' ' + originX + ' ' + squareR),
        baseT = r.rect(0, 0, 126, 126),

        firstFloorL = r.path('M' + originX + ' ' + originY + ' ' + rectangleL),
        firstFloorR = r.path('M' + originY + ' ' + originX + ' ' + rectangleR),
        firstFloorT = r.rect(0, 0, 126, 126),

        secondFloorL = r.path('M' + originX + ' ' + originY + ' ' + rectangleL),
        secondFloorR = r.path('M' + originY + ' ' + originX + ' ' + rectangleR),
        secondFloorT = r.rect(0, 0, 126, 126),

        topFloorL = r.path('M' + originX + ' ' + originY + ' ' + rectangleL),
        topFloorR = r.path('M' + originY + ' ' + originX + ' ' + rectangleR),
        topFloorT = r.rect(0, 0, 126, 126),

        indentL = r.path('M' + indentStartPt + ' ' + indentStartPt + ' l' + indentHeight + '  0 l0  0    l-' + indentHeight + ' 0  l0 0'),
        indentR = r.path('M' + indentStartPt + ' ' + indentStartPt + ' l0   ' + indentHeight + ' l0  0  l0  -' + indentHeight + ' l0 0'),
        indentT = r.rect(indentStartPt, indentStartPt, indentHeight , indentHeight ),

        starCenterL = r.path('M' + starStartPt + ' ' + (starStartPt + starUnit) + ' l0  0 l' + starUnit + '  0   l0 0 l-' + starUnit + ' 0'),
        starCenterR = r.path('M' + (starStartPt + starUnit) + ' ' + starStartPt + ' l0  0 l0   ' + starUnit + '  l0 0 l0  -' + starUnit + ''),
        starCenterT = r.rect(starStartPt, starStartPt, starUnit, starUnit), 
        
        /*TODO: Make other star parts*/
        starRightL = r.path('M' + (starEndPt+starUnit+starLimb) + ' ' + (starEndPt + starLimb+starUnit) + ' l' + starUnit +  ' ' + starUnit + ' l0   0  l-' + starUnit +  ' -'  + starUnit +  'l0  0'),
        starRightR = r.path('M' + (starEndPt + starUnit + starLimb) + ' ' + (starEndPt + starLimb) + ' l' + starUnit +  ' ' + starUnit + ' l0   ' + starUnit + '  l-' + starUnit +  ' -'  + starUnit +  'l0  -' + starUnit + ''),
        starRightT = r.rect(starEndPt+starUnit+starLimb, starEndPt+starLimb, 0, starUnit),

        starLeftL = r.path('M' + starEndPt + ' ' + (starEndPt + starUnit) + ' l0  0 l' + starUnit + '  0   l0 0 l-' + starUnit + ' 0'),
        starLeftT = r.rect(starEndPt+starUnit-starLimb, starEndPt+starLimb, 0, starUnit),

        starFrontL = r.path('M' + starEndPt + ' ' + (starEndPt + starUnit) + ' l0  0 l' + starUnit + '  0   l0 0 l-' + starUnit + ' 0'),
        starFrontR = r.path('M' + (starEndPt + starUnit) + ' ' + starEndPt + ' l0  0 l0   ' + starUnit + '  l0 0 l0  -' + starUnit + ''),
        starFrontT = r.rect(starEndPt, starEndPt, starUnit, 0),

        starBackR = r.path('M' + (starEndPt + starUnit) + ' ' + starEndPt + ' l0  0 l0   ' + starUnit + '  l0 0 l0  -' + starUnit + ''),
        starBackT = r.rect(starEndPt, starEndPt, starUnit, 0),


        allTops = r.set([baseT, firstFloorT, secondFloorT, topFloorT, indentT, starCenterT,starRightT, starLeftT, starFrontT, starBackT])
        allLefts = r.set([baseL, firstFloorL, secondFloorL, topFloorL, indentL, starCenterL,starRightL, starLeftL, starFrontL])
        allRights = r.set([baseR, firstFloorR, secondFloorR, topFloorR, indentR, starCenterR,starRightR, starFrontR, starBackR])
        invisible = r.set([indentT, starCenterT,starFrontL, starRightR])

        forplacing = r.set([starLeftT, starFrontT, starBackT, starLeftL, starFrontL, starFrontR, starBackR])
       

        set = r.set([allTops, allLefts, allRights])


    set.transform('T311,309 s1,0.575 ,0,0r45,0,0')

    allLefts.attr({ fill:'#536782', stroke:'none' })
    allRights.attr({ fill:'#8ea2bd', stroke:'none' })
    allTops.attr({ fill:'#ccc', stroke:'none' })

    invisible.attr({ fill:'none', stroke:'none' })
    forplacing.attr({stroke: '#000'})



    
    var firstGrowL = Raphael.animation({path: 'M' + heightXOne + ' ' + heightYOne + ' ' + rectangleL}, duration, "elastic");
    var firstGrowR = Raphael.animation({path: 'M' + heightYOne + ' ' + heightXOne + ' ' + rectangleR}, duration,"elastic");
    var firstGrowT = Raphael.animation({y: heightXOne, x: heightXOne}, duration, "elastic");

    var secondGrowL = Raphael.animation({path: 'M' + heightXTwo + ' ' + heightYTwo + ' ' + rectangleL}, duration, "elastic");
    var secondGrowR = Raphael.animation({path: 'M' + heightYTwo + ' ' + heightXTwo + ' ' + rectangleR}, duration,"elastic");
    var secondGrowT = Raphael.animation({y: heightXTwo, x: heightXTwo}, duration, "elastic");

    
    var finalGrowL = Raphael.animation({path: 'M' + heightXThree + ' ' + heightYThree + ' ' + squareL}, duration, "elastic");
    var finalGrowR = Raphael.animation({path: 'M' + heightYThree + ' ' + heightXThree + ' ' + squareR}, duration, "elastic");
    var finalGrowT = Raphael.animation({y: heightXThree, x: heightXThree}, duration, "elastic");

    
    var finalIndentL = Raphael.animation({path: 'M' + indentStartPt + ' ' + indentStartPt + ' l' + indentHeight + '  0 l' + indentHeight + '  ' + indentHeight + '    l-' + indentHeight + ' 0  l-' + indentHeight + ' -' + indentHeight + ' '}, duration/3);
    var finalIndentR = Raphael.animation({path: 'M' + indentStartPt + ' ' + indentStartPt + ' l0   ' + indentHeight + ' l' + indentHeight + '  ' + indentHeight + '  l0  -' + indentHeight + ' l-' + indentHeight + ' -' + indentHeight + ' '}, duration/3);
    var finalIndentT = Raphael.animation({x: indentEndPt, y: indentEndPt}, duration/3);

    
    var starUpL = Raphael.animation({path: 'M' + starEndPt + ' ' + (starEndPt + starUnit) + ' l' + starHeight + '  ' + starHeight + ' l' + starUnit + '  0   l-' + starHeight + ' -' + starHeight + ' l-' + starUnit + ' 0'}, duration/3);
    var starUpR = Raphael.animation({path: 'M' + (starEndPt + starUnit) + ' ' + starEndPt + ' l' + starHeight + '  ' + starHeight + ' l0   ' + starUnit + '  l-' + starHeight + ' -' + starHeight + ' l0  -' + starUnit + ''}, duration/3);
    var starUpT = Raphael.animation({x:starEndPt, y:starEndPt}, duration/3);

    var starBurstRT = Raphael.animation({width:starLimb}, duration);
    var starBurstRR = Raphael.animation({path: 'M' + (starEndPt + starUnit + 2*starLimb) + ' ' + (starEndPt + starLimb) + ' l' + starUnit +  ' ' + starUnit + ' l0   ' + starUnit + '  l-' + starUnit +  ' -'  + starUnit +  'l0  -' + starUnit + ''}, duration);
    var starBurstRL = Raphael.animation({path: 'M' + (starEndPt+starUnit+starLimb) + ' ' + (starEndPt + starLimb+starUnit) + ' l' + starUnit +  ' ' + starUnit + ' l'+ starLimb +  ' 0 l-' + starUnit +  ' -'  + starUnit +  'l0  -' + starLimb}, duration)


    var starBurstLT = Raphael.animation({width:starLimb}, duration);


    var firstLevelUp = function() {
        firstFloorR.animate(firstGrowR);
        firstFloorL.animate(firstGrowL);
        firstFloorT.animate(firstGrowT);

        secondFloorR.animate(firstGrowR);
        secondFloorL.animate(firstGrowL);
        secondFloorT.animate(firstGrowT);

        topFloorR.animate(firstGrowR);
        topFloorL.animate(firstGrowL);
        topFloorT.animate(firstGrowT);
    }
    
    var secondLevelUp = function() {
        secondFloorR.animate(secondGrowR);
        secondFloorL.animate(secondGrowL);
        secondFloorT.animate(secondGrowT);

        topFloorR.animate(secondGrowR);
        topFloorL.animate(secondGrowL);
        topFloorT.animate(secondGrowT);
    }
    
    var finalLevelUp = function() {
        topFloorR.animate(finalGrowR);
        topFloorL.animate(finalGrowL);
        topFloorT.animate(finalGrowT); 

        window.setTimeout(indent, duration);
        window.setTimeout(star, duration+duration/3);
        window.setTimeout(starBurst, duration+duration*2/3);
    }

    var indent = function() {
        indentT.attr({ fill:'#ccc', stroke:'none' })
        indentR.animate(finalIndentR);
        indentL.animate(finalIndentL);
        indentT.animate(finalIndentT);
    }

    var star=function() {
        starCenterT.attr({ fill:'#ccc', stroke:'none' })
        starCenterR.animate(starUpR);
        starCenterL.animate(starUpL);
        starCenterT.animate(starUpT);
    }

    var starBurst=function() {

        starRightR.attr({ fill:'#8ea2bd', stroke:'none' });

        starRightR.animate(starBurstRR);
        starRightL.animate(starBurstRL);
        starRightT.animate(starBurstRT);

        // starLeftL.animate(starBurstLL);
        starLeftT.animate(starBurstLT);

        // starFrontR.animate(starBurstFR);
        // starFrontL.animate(starBurstFL);
        // starFrontT.animate(starBurstFT);

        // starBackR.animate(starBurstBR);
        // starBackT.animate(starBurstBT);
    }

    var fullAnimation = function() {
        firstLevelUp();
        window.setTimeout(secondLevelUp,duration);
        window.setTimeout(finalLevelUp,duration*2);
    }
        

</script>
</body>
</html>
